#include "calculator_executor_test.h"

static t_tests tests[] = {
    {"3+4", 7.0},
    {"10-5", 5.0},
    {"6*7", 42.0},
    {"8/2", 4.0},
    {"3+4*5", 23.0},
    {"(3+4)*5", 35.0},
    {"10/3", (10.0 / 3)},
    {"5 * (2+3) - 4/2", 23.0},
    {"((10 + 5) * (20 / 4)) - 15", 60.0},
    {"((50 - 30) * 4) + (12 / 3)", 84.0},
    {"(10 + (2 * 3)) * ((8 - 4) / 2)", 32.0},
    {"((15 + 5) * 2) - (3 + 7)", 30.0},
    {"(10 * (-5 + 5) / (5 / 3) - 2) * (-1)", 2.0},
    {"(2-4)-(-6)", 4.0},
    {"(25 - (3 * 4)) + ((6 / 2) * 5)", 28.0},
    {"((10 + 2) * (3 + 2)) - 5", 55.0},
    {"(100 + 50) / ((5 * 2) - 5)", 30.0},
    {"(((10 + 5) * 3) - 15) / 5", 6.0},
    {"(8 + (5 * 2)) - (3 * (2 + 1))", 9.0},
    {"(10 * (5 + 2)) / (4 + 1)", 14.0},
    {"((30 - 5) * 2) + (100 / 5)", 70.0},
    {"(25 + 5) * ((3 + 2) / 5)", 30.0},
    {"((2 + 3) * (5 + 5)) / (4 - 2)", 25.0},
    {"((40 / 5) * 2) + (10 - 3)", 23.0},
    {"(((5 + 5) * 3) - (2 * 5)) / 5", 4.0},
    {"(20 + (3 * 5)) - (2 * (4 + 1))", 25.0},
    {"(10 + (5 * (3 + 2))) / 5", 7.0},
    {"((5 * 5) + (3 * 2)) - 20", 11.0},
    {"(100 + 50) / (2 * (2 + 3))", 15.0},
    {"((25 * 2) / (5 + 5)) * 3", 15.0},
    {"(((50 / 5) + 10) * 2) - 5", 35.0},
    {"(10 * (5 + 5)) / (3 + 2)", 20.0},
    {"(((20 + 10) / 5) * 3) - 2", 16.0},
    {"(10 + (5 * 2)) * (3 - 1)", 40.0},
    {"((3 + 2) * (4 + 6)) / 5", 10.0},
    {"(10 - 2) * ((5 + 5) / 2)", 40.0},
    {"(((6 * 5) + 20) / 10) - 2", 3.0},
    {"(25 + (3 * 4)) / (2 + 3)", 7.4},
    {"(((10 + 2) * 3) - 5) / 5", 6.2},
    {"((5 + 5) * (10 / 2)) + 5", 55.0},
    {"(100 - (10 * 5)) + 25", 75.0},
    {"(((50 - 10) / 5) * 4) - 3", 29.0},
    {"((10 * 2) + 10) / (5 + 5)", 3.0},
    {"(3 + 2) * (4 + 6) - 5", 45.0},
    {"(((5 + 5) * 2) + 10) / 5", 6.0},
    {"(100 / (5 + 5)) + 10", 20.0},
    {"((25 / 5) + 10) * 2", 30.0},
    {"(50 * (10 / 5)) - 5", 95.0},
    {"(10 * (3 + 2)) / 5", 10.0},
    {"(25 * (2 + 3)) / (4 + 1)", 25.0},
    {"(((10 + 5) * 3) / (5 + 5)) + 2", 6.5},
    {"(100 / (2 * 2)) * 5", 125.0},
    {"(10 + (3 * 2)) - ((6 / 2) * 5)", 1.0},
    {"(5 + 3) * (2 + 1)", 24.0},
    {"(20 * (5 + 2)) / 10", 14.0}
};

t_error* calculator_executor_test(t_error* Error) {
    logger(TRACE, "Run tests for calculator executor logic ...");
    t_vector* Vector;

    size_t numTests = sizeof(tests) / sizeof(tests[0]);
    for (size_t i = 0; i < numTests; ++i) {
        char* expression = tests[i].expression;
        size_t size = strlen(expression);

        if (tokenizer_code(expression, size, Error)->message) {
            return Set(Error, format(__func__, ""));
        }
        Vector = Error->value;
        print_vector(Vector);

        if (parse(Vector, Error)->message) {
            return Set(Error, format(__func__, ""));
        }

        if (validator(Vector, Error)->message) {
            return Set(Error, format(__func__, ""));
        }

        long double result = calculator_core(Error->value);
        assert(fabsl(result - tests[i].expected) < 1e-5L);
        printf("%s = (%Lf)\n", tests[i].expression, result);
        free_vector(&Vector);
    }
    if (Vector)
        free_vector(&Vector);
    return Error;
}